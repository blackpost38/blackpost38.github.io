<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 도커 컨테이너 끼리 통신 · Dev Blog</title><meta name="description" content="도커 컨테이너 끼리 통신 - Hyunju Choi"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blackpost38.github.io/atom.xml" title="Dev Blog"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">Dev Blog</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>INDEX</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>ARCHIVES</p></a><ul class="shortcut-icons"><a href="https://github.com/blackpost38" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">도커 컨테이너 끼리 통신</h1><div class="post-info">Jan 13, 2018</div><div class="post-content"><h1 id="이슈"><a href="#이슈" class="headerlink" title="이슈"></a><a href="#이슈" title="이슈"></a>이슈</h1><h2 id="현상"><a href="#현상" class="headerlink" title="현상"></a><a href="#현상" title="현상"></a>현상</h2><ul>
<li>도커 컨테이너 끼리의 통신이 연결되지 않는다.</li>
</ul>
<h2 id="상황"><a href="#상황" class="headerlink" title="상황"></a><a href="#상황" title="상황"></a>상황</h2><ul>
<li>컨테이너 A에서 컨테이너 B의 API를 호출하고 싶다.</li>
<li>컨테이너 A는 localhost 3000 포트로 설정되어 있다.</li>
<li>컨테이너 B는 localhost 4000 포트로 설정되어 있다.</li>
<li>컨테이너 A에서 localhost 4000 포트로 Request를 보내면 응답하지 않는다.</li>
</ul>
<h2 id="원인"><a href="#원인" class="headerlink" title="원인"></a><a href="#원인" title="원인"></a>원인</h2><ul>
<li>도커 컨테이너가 자신의 localhost가 다른 의미를 갖게 된다.</li>
<li>도커 컨테이너의 IP를 살펴보면, <code>172.17.0.X</code> 같은 별도의 로컬 IP를 갖게 된다.</li>
<li>도커 컨테이너는 기본적으로 도커 네트워크 <strong>bridge</strong>에 속한다.</li>
<li>따라서 도커 컨테이너에서 localhost의 의미는 자기 자신의 컨테이너 IP를 가르키게 되버린다. (내 컴퓨터의 IP가 아닌!!)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker run -itd –name=container1 busybox</span><br><span class="line">&gt; docker run -itd –name=container2 busybox</span><br><span class="line">&gt; docker network inspect bridge</span><br><span class="line"></span><br><span class="line">…</span><br><span class="line">&quot;Containers&quot;: &#123;</span><br><span class="line">  &quot;0f65120b94a56c26124322ce272b74657b46ad12176caa79a576c660b7c01864&quot;: &#123;</span><br><span class="line">      &quot;Name&quot;: &quot;container1&quot;,</span><br><span class="line">      &quot;EndpointID&quot;: &quot;f71fd32ada7721d1412d0ceca764a6890e8902eaad1fd9bbfde39030ff717b89&quot;,</span><br><span class="line">      &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">      &quot;IPv4Address&quot;: &quot;172.17.0.2/16&quot;,</span><br><span class="line">      &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;13bf17f4b7fec846a71c15efdf3d7264ed289ff2f7b70c258ae4faaf567f6f5c&quot;: &#123;</span><br><span class="line">      &quot;Name&quot;: &quot;container2&quot;,</span><br><span class="line">      &quot;EndpointID&quot;: &quot;a3379ded18d90c0e9d607982cda7b93a87951b0c042eb59a0c76fe59f31ce8fa&quot;,</span><br><span class="line">      &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">      &quot;IPv4Address&quot;: &quot;172.17.0.3/16&quot;,</span><br><span class="line">      &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">…</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="해결법"><a href="#해결법" class="headerlink" title="해결법"></a><a href="#해결법" title="해결법"></a>해결법</h1><h2 id="도커-컨테이너-IP로-통신하기"><a href="#도커-컨테이너-IP로-통신하기" class="headerlink" title="도커 컨테이너 IP로 통신하기"></a><a href="#도커-컨테이너-IP로-통신하기" title="도커 컨테이너 IP로 통신하기"></a>도커 컨테이너 IP로 통신하기</h2><ul>
<li>도커 컨테이너끼리 기본적으로 bridge라는 동일한 도커 네트워크에 속해 있으므로 IP를 입력하여 통신할 수 있다.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker attach container1`</span><br><span class="line">&gt; ping 172.17.0.3</span><br><span class="line"></span><br><span class="line">PING 172.17.0.3 (172.17.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.3: seq=0 ttl=64 time=0.140 ms</span><br><span class="line">64 bytes from 172.17.0.3: seq=1 ttl=64 time=0.116 ms</span><br><span class="line">64 bytes from 172.17.0.3: seq=2 ttl=64 time=0.159 ms</span><br></pre></td></tr></table></figure></li>
<li><p>문제점은 도커 컨테이너가 재시작 되면 이 IP가 변경될 가능성이 있다.</p>
</li>
<li><p>언제든지 변경될 가능성이 생기기 때문에 웹 어플리케이션에 다이나믹한 IP를 설정하기엔 어려움이 있다.</p>
</li>
</ul>
<h2 id="도커-컨테이너-이름으로-통신하기"><a href="#도커-컨테이너-이름으로-통신하기" class="headerlink" title="도커 컨테이너 이름으로 통신하기"></a><a href="#도커-컨테이너-이름으로-통신하기" title="도커 컨테이너 이름으로 통신하기"></a>도커 컨테이너 이름으로 통신하기</h2><ul>
<li>도커 컨테이너 이름을 명시해서 통신하는 방법이 있다.</li>
<li>그러기 위해서 컨테이너를 시작할 때 <code>--link</code> 옵션을 사용한다.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker run –link container2:container2 -itd –name=container1 busybox</span><br><span class="line">&gt; docker attach container1</span><br><span class="line">&gt; ping container2</span><br><span class="line"></span><br><span class="line">PING container2 (172.21.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.21.0.3: seq=0 ttl=64 time=0.268 ms</span><br><span class="line">64 bytes from 172.21.0.3: seq=1 ttl=64 time=0.102 ms</span><br><span class="line">64 bytes from 172.21.0.3: seq=2 ttl=64 time=0.163 ms</span><br></pre></td></tr></table></figure></li>
<li><p><code>--link</code> 옵션을 추가하면 뭐가 달라질까?</p>
<ul>
<li>옵션 내용이 <code>/etc/hosts</code>에 반영된다.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker attach container1</span><br><span class="line">&gt; cat /etc/hosts</span><br><span class="line"></span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">172.17.0.2      container2 d759e0e85689</span><br><span class="line">172.17.0.3      87c4059eb3b6</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="알고보니-레거시-옵션"><a href="#알고보니-레거시-옵션" class="headerlink" title="알고보니 레거시 옵션"></a><a href="#알고보니-레거시-옵션" title="알고보니 레거시 옵션"></a>알고보니 레거시 옵션</h2><ul>
<li><code>--link</code> 옵션은 현재 레거시 옵션으로 분류되어 있으며 나중에 언제라도 없어질 수 있다.</li>
<li>도커 문서에서는 직접 네트워크를 정의하여 추가하는 방법을 제안한다.</li>
</ul>
<h2 id="유저-정의-네트워크"><a href="#유저-정의-네트워크" class="headerlink" title="유저 정의 네트워크"></a><a href="#유저-정의-네트워크" title="유저 정의 네트워크"></a>유저 정의 네트워크</h2><ul>
<li>bridge 네트워크 같은 도커 네트워크를 사용자가 직접 정의할 수 있다.</li>
<li><p>장점은 컨테이너 이름을 IP로 풀어주는 DNS가 자동으로 세팅된 다는 점이다.</p>
<pre><code>*   즉, 컨테이너 이름으로 통신이 가능하다는 것
</code></pre></li>
<li>네트워크 정의한 후 도커 컨테이너 포함 시키기<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker network create my-network</span><br><span class="line">&gt; docker network connect my-network container1</span><br><span class="line">&gt; docker network connect my-network container2</span><br></pre></td></tr></table></figure></li>
<li>포함 시킨 후 container1에서 ping을 실행해보자<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker attach container1</span><br><span class="line">&gt; ping container2</span><br><span class="line"></span><br><span class="line">PING container2 (172.21.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.21.0.3: seq=0 ttl=64 time=0.268 ms</span><br><span class="line">64 bytes from 172.21.0.3: seq=1 ttl=64 time=0.102 ms</span><br><span class="line">64 bytes from 172.21.0.3: seq=2 ttl=64 time=0.163 ms</span><br></pre></td></tr></table></figure></li>
</ul>
</div></article></div><div id="disqus_thread"></div></div><script>var disqus_shortname = 'blackpost38';
var disqus_identifier = '2018/01/13/networking-docker-container/';
var disqus_title = '도커 컨테이너 끼리 통신';
var disqus_url = 'https://blackpost38.github.io/2018/01/13/networking-docker-container/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//blackpost38.disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a href="/2018/01/20/unable-to-find-a-live-medium-containing-a-live-file-system-error-message/" class="prev">PREV</a><a href="/2018/01/13/array-sort-bad-example/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2019 <a href="https://blackpost38.github.io">Hyunju Choi</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"blackpost38",'auto');ga('send','pageview');</script></body></html>